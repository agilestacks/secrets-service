---
version: 1
kind: component
meta:
  name: secrets-service
  brief: Secrets service
  source:
      dir: ../api

requires:
- kubernetes

parameters:
- name: cloud.vpc.cidr
  env:  VPC_CIDR
- name: component.vault.source_dir
  env:  VAULT_COMPONENT_SOURCE_DIR
- name: component.secrets-service
  parameters:
  - name: namespace
    default: automation-hub
    env:  NAMESPACE
  - name: image
    env:  IMAGE
  - name: service
    default: secrets
  - name: vaultApiEndpoint
    kind: user
    default: "*unset*"
    fromEnv: VAULT_API
- name: dns.domain
  brief: DNS domain
  kind: tech

templates:
  files: ["templates/*.template"]
  extra:
  - kind: curly
    files: ["*.template"]

outputs:
- name: component.secrets-service.endpoint
  brief: Secrets Service API endpoint
  value: http://${component.secrets-service.service}.${component.secrets-service.namespace}.svc.cluster.local/api/v1
- name: component.secrets-service.app-roles.secret
  brief: Name of the secret that has been created with ids of app roles
  fromTfVar: app_roles_secret
